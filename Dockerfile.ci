ARG image_tag=latest
FROM elifesciences/profiles:${image_tag}

USER root
RUN mkdir build && \
    chown www-data:www-data build

COPY --chown=elife:elife \
    .coveragerc \
    .flake8 \
    project_tests.sh \
    .pylintrc \
    pytest.ini \
    requirements-debug.txt
    ./

RUN venv/bin/pip install --requirement requirements-debug.txt --no-cache-dir
COPY --chown=elife:elife test/ /srv/profiles/test/

USER www-data
CMD ["./project_tests.sh"]
